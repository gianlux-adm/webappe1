@model Ica.SalesOrders.Web.ViewModels.WarehouseIndexViewModel
@{
    ViewBag.Title = Html.Translate("Menu", "UserManagement");
}        
        <div id="searchForm">

            <div class="box filtro">
                <div class="box-header with-border">
                    <h3 class="box-title">@Html.Translate("Shared", "Filter")</h3>
                    <div class="box-tools pull-right">
                        <button type="button" class="btn btn-box-tool" data-widget="collapse">
                            <i class="fa fa-minus"></i>
                        </button>
                    </div>
                </div>
                <!-- /.box-header -->
                <div class="box-body form-horizontal">

                    <div class="row" style="display:none">
                        <div class="col-sm-6 col-xs-12">
                            <label class="control-label">@Html.Translate("Warehouse", "Availability")</label>
                        </div>
                    </div>
                    <div class="row" style="display:none">
                        <div class="col-sm-6 col-xs-12">
                            @Html.DropDownListFor(m => m.Availability, new SelectList(Model.ValoriAvailability, "Key", "Value"), new { @class = "form-control" })
                            <input type="hidden" id="searchId" value="@Guid.NewGuid()" />
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-sm-12 col-xs-12">
                            <label class="control-label">@Html.Translate("Warehouse", "ArticleCode")</label>
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-sm-12 col-xs-12">
                            <div class="input-group input-group">
                                <div class="input-group-btn">
                                    <button id="type_CodiceArticoloText" data-type="0" type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown" aria-expanded="false">
                                        @Html.Translate("Warehouse", "ArticleCode")
                                        <span class="fa fa-caret-down"></span>
                                    </button>
                                    <ul class="dropdown-menu">
                                        <li onclick="changeMode(this)" data-type="0"><a href="#">@Html.Translate("Warehouse", "ArticleCode")</a></li>
                                        <!--<li onclick="changeMode(this)" data-type="1"><a href="#">@Html.Translate("Warehouse", "Description")</a></li>-->
                                    </ul>
                                </div>
                                <div class="typeahead-container">
                                    <div class="typeahead-field">
                                        <span class="typeahead-query">
                                            <input type="text" id="CodiceArticoloText" class="form-control myText" autocomplete="off" />
                                        </span>
                                    </div>
                                </div>

                                <span class="input-group-addon" style="cursor: pointer;"><i class="fa fa-remove"></i></span>
                            </div>


                            <input type="hidden" id="CodiceArticolo" name="CodiceArticolo" value="@Model.CodiceArticolo" />
                        </div>
                    </div>

                    <div class="row" style="display:none">
                        <div class="col-md-3 col-sm-6 col-xs-12">
                            <label class="control-label">@Html.Translate("Warehouse", "Category1")</label>
                        </div>
                        <div class="col-md-3 col-sm-6 col-xs-12 hidden-xs">
                            <label class="control-label">@Html.Translate("Warehouse", "Category2")</label>
                        </div>
                        <div class="col-md-3 col-sm-6 col-xs-12 hidden-xs hidden-sm">
                            <label class="control-label">@Html.Translate("Warehouse", "Category3")</label>
                        </div>
                        <div class="col-md-3 col-sm-6 col-xs-12 hidden-xs hidden-sm">
                            <label class="control-label">@Html.Translate("Warehouse", "Category4")</label>
                        </div>
                    </div>

                    <div class="row" style="display:none">
                        <div class="col-md-3 col-sm-6 col-xs-12">
                            <div class="col-xs-11 col-md-11 col-sm-11 col-lg-11" style="padding-left:0px;padding-right:0px;">
                                @Html.DropDownListFor(m => m.Categoria1, new SelectList(Model.ValoriCategoria1, "Key", "Value"), Html.Translate("Shared", "All"), new { @class = "form-control" })
                            </div>
                        </div>
                        <div class="col-md-3 col-sm-6 col-xs-12 hidden-lg hidden-md hidden-sm">
                            <label class="control-label">@Html.Translate("Warehouse", "Category2")</label>
                        </div>
                        <div class="col-md-3 col-sm-6 col-xs-12">
                            <div class="col-xs-11 col-md-11 col-sm-11 col-lg-11" style="padding-left:0px;padding-right:0px;">
                                @Html.DropDownListFor(m => m.Categoria2, new SelectList(Model.ValoriCategoria2, "Key", "Value"), Html.Translate("Shared", "All"), new { @class = "form-control" })
                            </div>
                            <div class="col-xs-1 col-md-1 col-sm-1 col-lg-1" id="loading_cat_2" style="padding-left:0px;padding-right:0px;">

                            </div>
                        </div>
                        <div class="col-md-3 col-sm-6 col-xs-12 hidden-lg hidden-md">
                            <label class="control-label">@Html.Translate("Warehouse", "Category3")</label>
                        </div>
                        <div class="col-md-3 col-sm-6 col-xs-12 hidden-lg hidden-md hidden-xs">
                            <label class="control-label">@Html.Translate("Warehouse", "Category4")</label>
                        </div>
                        <div class="col-md-3 col-sm-6 col-xs-12">
                            <div class="col-xs-11 col-md-11 col-sm-11 col-lg-11" style="padding-left:0px;padding-right:0px;">
                                @Html.DropDownListFor(m => m.Categoria3, new SelectList(Model.ValoriCategoria3, "Key", "Value"), Html.Translate("Shared", "All"), new { @class = "form-control" })
                            </div>
                            <div class="col-xs-1 col-md-1 col-sm-1 col-lg-1" id="loading_cat_3" style="padding-left:0px;padding-right:0px;">

                            </div>
                        </div>
                        <div class="col-md-3 col-sm-6 col-xs-12 hidden-lg hidden-md hidden-sm">
                            <label class="control-label">@Html.Translate("Warehouse", "Category4")</label>
                        </div>
                        <div class="col-md-3 col-sm-6 col-xs-12">
                            <div class="col-xs-11 col-md-11 col-sm-11 col-lg-11" style="padding-left:0px;padding-right:0px;">
                                @Html.DropDownListFor(m => m.Categoria4, new SelectList(Model.ValoriCategoria4, "Key", "Value"), Html.Translate("Shared", "All"), new { @class = "form-control" })
                            </div>
                            <div class="col-xs-1 col-md-1 col-sm-1 col-lg-1" id="loading_cat_4" style="padding-left:0px;padding-right:0px;">

                            </div>
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-sm-6">

                        </div>
                        <div class="col-sm-6">
                            <button id="btn_search" type="button" class="btn btn-default" style="float:right">@Html.Translate("Shared", "Search")</button>
                        </div>

                    </div>




                </div>
            </div>

            <div id="results" style="display:none;">
               
            </div>
        </div>


        <div class="homeLoading" style="display:none;text-align:center;">
            <i class="fa fa-refresh fa-spin" style="font-size:150px;margin-top:100px;margin-bottom:50px;"></i><br /><br />
            <span id="homeLoadingSpan" style="font-size:20px;"></span>
        </div>
        <div id="details" style="display:none">

        </div>

        @section scripts {
            
            <script type="text/javascript">

        function changeMode(item) {
            var type = $(item).attr("data-type");
            $("#type_CodiceArticoloText").attr("data-type", type);
            $("#type_CodiceArticoloText").attr("data-type", type).html($("a", item).html() + "<span class='fa fa-caret-down'></span>");
            debugger;
        }
        function searchWarehouse_OnBegin() {
            $("#homeLoadingSpan").html("@Html.Translate("Shared", "Loading")");
            $(".homeLoading").show();

        }

        function searchWarehouse_OnComplete(data, a, b) {
            $(".homeLoading").hide();
            $("#results").html(data);
        }

        var dt;

                function guid() {
                    function s4() {
                        return Math.floor((1 + Math.random()) * 0x10000)
                            .toString(16)
                            .substring(1);
                    }
                    return s4() + s4() + '-' + s4() + '-' + s4() + '-' + s4() + '-' + s4() + s4() + s4();
                }

    $(document).ready(function () {


        $("#btn_search").click(function () {
            $("#results").hide();
            $("#searchId").val(guid());
            $("#homeLoadingSpan").html("@Html.Translate("Shared", "Loading")");
            $(".homeLoading").show();

            $.post("/Warehouse/GetResults", {
                searchId: $("#searchId").val()
                , Availability: $("#Availability").val()
                , CodiceArticolo: $("#CodiceArticolo").val()
            }, function (data) {
                $("#results").html(data);
                $(".homeLoading").hide();
                $("#results").show();
            });

            /*
            "sAjaxSource": "/Warehouse/GetResults",

            //dt.fnSort([1, "asc"]);

            if (a.Message) {
                $(".homeLoading").hide();
                $("#results").show();
                alert(a.Message);
            }
            else {
                callback(a, b, c, d);
            }
            */
        });

        initAutocompleteCodiceArticolo("#CodiceArticoloText", "#CodiceArticolo", "@Html.Translate("Shared", "NoResults")");
    });

        function getDetail(id, searchId) {
            $("#searchForm").hide();
            $("#homeLoadingSpan").html("@Html.Translate("Shared", "Loading")");
            $(".homeLoading").show();
            $.get("/Warehouse/Details?id=" + id + "&searchId=" + searchId, function (data) {
                $("#details").html(data);
                $(".homeLoading").hide();
                $("#details").show();
            });
        }

        function goHome() {
            $("#details").hide();
            $("#searchForm").show();
        }

    function execDataQueryForDDL(mode) {
        var cat1 = $("#Categoria1").val();
        var cat2 = $("#Categoria2").val();
        var cat3 = $("#Categoria3").val();

        $.getJSON("/Warehouse/GetDDL?cat1=" + cat1 + "&cat2=" + cat2 + "&cat3=" + cat3 + "&mode=" + mode, function (data) {
            $("#" + mode).html("");
            $("#" + mode).append("<option value=''>@Html.Translate("Shared","All")</option>");
            $(data).each(function (i, item) {
                $("#" + mode).append("<option value='" + item.Key +"'>" + item.Value +"</option>")
            });

            if (mode == "Categoria4") {
                $("#loading_cat_4").html("");
            }
            if (mode == "Categoria3") {
                $("#loading_cat_3").html("");
            }
            if (mode == "Categoria2") {
                $("#loading_cat_2").html("");
            }

            clearNextDDL();
        });


    }

    function clearNextDDL() {
        var cat1 = $("#Categoria1").val();
        var cat2 = $("#Categoria2").val();
        var cat3 = $("#Categoria3").val();

        if ((cat1 == "") || (cat1==undefined) || (cat1==null)) {
            $("#Categoria2").html("<option value=''>@Html.Translate("Shared","All")</option>");
            $("#Categoria3").html("<option value=''>@Html.Translate("Shared","All")</option>");
            $("#Categoria4").html("<option value=''>@Html.Translate("Shared","All")</option>");
        }
        else {
            if ((cat2 == "") || (cat2 == undefined) || (cat2 == null)) {
                $("#Categoria3").html("<option value=''>@Html.Translate("Shared","All")</option>");
                $("#Categoria4").html("<option value=''>@Html.Translate("Shared","All")</option>");
            }
            else {
                if ((cat3 == "") || (cat3 == undefined) || (cat3 == null)) {
                    $("#Categoria4").html("<option value=''>@Html.Translate("Shared","All")</option>");
                }
            }
        }

    }
            </script>
        }
